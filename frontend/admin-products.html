<!DOCTYPE html>
<html class="no-js" lang="zxx">
  <head>
    <meta charset="utf-8" />
    <title>Admin Products - biteexpress Restaurant</title>
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,shrink-to-fit=no"
    />
    <link
      rel="apple-touch-icon"
      sizes="57x57"
      href="assets/img/favicons/apple-icon-57x57.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="60x60"
      href="assets/img/favicons/apple-icon-60x60.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="72x72"
      href="assets/img/favicons/apple-icon-72x72.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="76x76"
      href="assets/img/favicons/apple-icon-76x76.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="114x114"
      href="assets/img/favicons/apple-icon-114x114.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="120x120"
      href="assets/img/favicons/apple-icon-120x120.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="144x144"
      href="assets/img/favicons/apple-icon-144x144.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="152x152"
      href="assets/img/favicons/apple-icon-152x152.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="assets/img/favicons/apple-icon-180x180.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="assets/img/favicons/android-icon-192x192.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="assets/img/favicons/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="96x96"
      href="assets/img/favicons/favicon-96x96.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="assets/img/favicons/favicon-16x16.png"
    />
    <link rel="manifest" href="assets/img/favicons/manifest.json" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta
      name="msapplication-TileImage"
      content="assets/img/favicons/ms-icon-144x144.png"
    />
    <meta name="theme-color" content="#ffffff" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bangers&family=Barlow+Condensed:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="assets/css/app.min.css" />
    <link rel="stylesheet" href="assets/css/fontawesome.min.css" />
    <link rel="stylesheet" href="assets/css/style.css" />
    <style>
      .modal-backdrop {
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1050;
        display: none;
      }
      .modal {
        background: #fff;
        border-radius: 18px;
        max-width: 400px;
        width: 100vw;
        height: 70vh;
        position: fixed;
        z-index: 1060;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        margin: 0;
        padding: 2em 1.5em;
        box-shadow: 0 8px 48px rgba(0, 0, 0, 0.25);
        display: none;
        max-height: 95vh;
        overflow-y: auto;
      }
      .modal .close {
        position: absolute;
        right: 1em;
        top: 1em;
        background: none;
        border: none;
        font-size: 1.3em;
        cursor: pointer;
      }
      .modal.show,
      .modal-backdrop.show {
        display: block;
      }
      .product-image {
        width: 60px;
        border-radius: 8px;
      }
      .action-btns .th-btn {
        margin-right: 8px;
      }
      #pagination {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        margin-top: 1rem;
      }
      #pagination button {
        min-width: 90px;
      }
      #pagination-info {
        margin: 0 1rem;
      }
      body.modal-open {
        overflow: hidden !important;
      }
      #filter-category {
        min-width: 130px;
        display: inline-block;
      }
    </style>
  </head>
  <body>
    <header class="th-header header-default">
      <div class="header-top d-sm-block d-none">
        <div class="container">
          <div
            class="row justify-content-center justify-content-lg-between align-items-center gy-2"
          >
            <div class="col-auto">
              <div class="header-links">
                <ul>
                  <li class="d-none d-xl-inline-block">
                    <i class="far fa-location-dot"></i>8502 Preston Rd.
                    Inglewood, Maine 98380
                  </li>
                  <li class="d-none d-md-inline-block">
                    <i class="far fa-envelope-open"></i
                    ><a href="mailto:info@biteexpress.com"
                      >info@biteexpress.com</a
                    >
                  </li>
                  <li class="d-none d-sm-inline-block">
                    <i class="far fa-clock"></i>Opening Hour: Mon to Sat - 9am
                    to 5pm
                  </li>
                </ul>
              </div>
            </div>
            <div class="col-auto d-none d-lg-block">
              <div class="header-links">
                <ul>
                  <li class="d-none d-xxl-inline-block header-contact">
                    <i class="far fa-phone"></i
                    ><a href="tel:26365479875">+263 6547 9875</a>
                  </li>
                  <li>
                    <div class="th-social">
                      <a href="https://www.facebook.com/"
                        ><i class="fab fa-facebook-f"></i
                      ></a>
                      <a href="https://www.twitter.com/"
                        ><i class="fab fa-twitter"></i
                      ></a>
                      <a href="https://www.linkedin.com/"
                        ><i class="fab fa-linkedin-in"></i
                      ></a>
                      <a href="https://www.whatsapp.com/"
                        ><i class="fab fa-whatsapp"></i
                      ></a>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="sticky-wrapper">
        <div class="menu-area">
          <div class="container">
            <div class="row align-items-center justify-content-between">
              <div class="col-auto">
                <div class="header-logo">
                  <a href="index.html"
                    ><img src="assets/img/logo.svg" alt="biteexpress"
                  /></a>
                </div>
              </div>
              <div class="col-auto">
                <nav class="main-menu d-none d-lg-inline-block">
                  <ul>
                    <li class="menu-item">
                      <a href="index.html">Home</a>
                    </li>
                    <li><a href="admin-products.html">Products</a></li>
                    <li><a href="admin-orders.html">Orders</a></li>
                  </ul>
                </nav>
                <div class="header-button d-flex d-lg-none">
                  <button type="button" class="icon-btn sideMenuToggler">
                    <span class="badge">5</span>
                    <i class="fa-regular fa-cart-shopping"></i>
                  </button>
                  <button type="button" class="icon-btn th-menu-toggle">
                    <i class="far fa-bars"></i>
                  </button>
                </div>
              </div>
              <div class="col-auto d-none d-xl-block">
                <div class="header-button">
                  <a href="#" class="th-btn btn-mask" id="adminLogoutBtn"
                    >Logout</a
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <div
      class="breadcumb-wrapper overflow-hidden"
      data-bg-src="assets/img/bg/breadcumb-bg.jpg"
    >
      <div class="container">
        <div class="row">
          <div class="col-lg-6">
            <div class="breadcumb-content">
              <h1 class="breadcumb-title">Admin - Products</h1>
              <ul class="breadcumb-menu">
                <li><a href="admin-dashboard.html">Admin Home</a></li>
                <li>Products</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="space-top space-extra-bottom">
      <div class="container">
        <div
          class="d-flex justify-content-between align-items-center mb-4"
          style="gap: 1.5rem"
        >
          <h2 class="h4 summary-title mb-0" style="white-space: nowrap">
            All Products
          </h2>
          <div class="d-flex align-items-center" style="gap: 1rem">
            <select
              id="filter-category"
              class="form-select"
              style="min-width: 130px"
            >
              <option value="All">All</option>
              <option value="Veg">Veg</option>
              <option value="Non-Veg">Non-Veg</option>
              <option value="Drinks">Drinks</option>
            </select>
            <button
              class="th-btn style2"
              id="add-product-btn"
              style="white-space: nowrap; min-width: 150px"
            >
              <i class="fa fa-plus"></i> Add Product
            </button>
          </div>
        </div>

        <div class="table-responsive">
          <table class="cart_table" id="products-table">
            <thead>
              <tr>
                <th>Image</th>
                <th>Name</th>
                <th>Description</th>
                <th>Category</th>
                <th>Available</th>
                <th>Price</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <!-- Pagination controls here -->
        <div id="pagination">
          <button class="th-btn style2" id="prev-page">Prev</button>
          <span id="pagination-info"></span>
          <button class="th-btn style2" id="next-page">Next</button>
        </div>
      </div>
    </div>

    <!-- Add/Edit Product Modal -->
    <div class="modal-backdrop" id="modal-backdrop"></div>
    <div class="modal" id="add-edit-modal">
      <button class="close" id="close-modal">&times;</button>
      <h3 id="modal-title">Add Product</h3>
      <form id="add-edit-form">
        <div class="mb-3">
          <label>Name</label>
          <input type="text" name="name" class="form-control" required />
        </div>
        <div class="mb-3">
          <label>Description</label>
          <textarea name="description" class="form-control" required></textarea>
        </div>
        <div class="mb-3">
          <label>Category</label>
          <select name="category" class="form-select" required>
            <option value="">Select</option>
            <option value="Veg">Veg</option>
            <option value="Non-Veg">Non-Veg</option>
            <option value="Drinks">Drinks</option>
          </select>
        </div>
        <div class="mb-3">
          <label>Available</label>
          <select name="available" class="form-select" required>
            <option value="1">Yes</option>
            <option value="0">No</option>
          </select>
        </div>
        <div class="mb-3">
          <label>Price</label>
          <input
            type="number"
            name="price"
            class="form-control"
            min="0"
            step="0.01"
            required
          />
        </div>
        <div class="mb-3">
          <label>Image URL</label>
          <input type="text" name="image_url" class="form-control" required />
        </div>
        <input type="hidden" name="id" />
        <button
          type="submit"
          class="th-btn style2 w-100 mt-2"
          id="save-product-btn"
        >
          Save
        </button>
      </form>
    </div>
    <footer class="footer-wrapper footer-default overflow-hidden">
      <div
        class="shape-mockup d-none d-xxl-block wow fadeinup"
        data-top="22%"
        data-left="0%"
      >
        <img src="assets/img/footer/footer-left.png" alt="img" />
      </div>
      <div
        class="shape-mockup moving d-none d-lg-block"
        data-top="10%"
        data-right="4%"
      >
        <img src="assets/img/shape/footer-top.png" alt="img" />
      </div>
      <div class="footer-top">
        <div class="container">
          <div class="row gy-40 align-items-center justify-content-center">
            <div class="col-xl-12">
              <div class="subscribe-box">
                <h2 class="footer-top_title">Letâ€™s Talk With Us</h2>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="widget-area">
        <div class="container">
          <div class="row gy-4 justify-content-center">
            <div class="col-md-12 col-lg-6 col-xl-4">
              <div class="widget footer-widget">
                <h3 class="widget_title">Contact Info</h3>
                <div class="icon">
                  <img src="assets/img/icon/f-title-icon.png" alt="icon" />
                </div>
                <div class="th-widget-contact">
                  <div class="info-box">
                    <p class="info-box_text">
                      <span>Phone:</span>
                      <a href="tel:256369854789" class="info-box_link"
                        >+256 3698 54789</a
                      >
                      <a href="tel:16354786985" class="info-box_link"
                        >+16354786985</a
                      >
                    </p>
                  </div>
                  <div class="info-box">
                    <p class="info-box_text">
                      <span>Email:</span>
                      <a
                        href="mailto:info@biteexpress.com"
                        class="info-box_link"
                        >info@biteexpress.com</a
                      >
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-12 col-lg-6 col-xl-4">
              <div class="widget widget_nav_menu footer-widget">
                <h3 class="widget_title">Quick Links</h3>
                <div class="icon">
                  <img src="assets/img/icon/f-title-icon.png" alt="icon" />
                </div>
                <div class="menu-all-pages-container">
                  <ul class="menu">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">About Us</a></li>
                    <li><a href="service.html">Our Services</a></li>
                    <li><a href="blog.html">News</a></li>
                    <li><a href="testimonials.html">Testimonials</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-md-12 col-lg-6 col-xl-4">
              <div class="widget widget_download footer-widget">
                <h4 class="widget_title">Download</h4>
                <div class="icon">
                  <img src="assets/img/icon/f-title-icon.png" alt="icon" />
                </div>
                <div class="download-widget-wrap">
                  <a href="https://www.apple.com/app-store/"
                    ><img src="assets/img/icon/f-app-store.png" alt="img" /> </a
                  ><a href="https://play.google.com/store/games?device=windows"
                    ><img src="assets/img/icon/f-google-store.png" alt="img"
                  /></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="copyright-wrap">
        <div class="container">
          <div class="copy-right-content">
            <div class="copyright-text-wrap">
              <p class="copyright-text">
                <i class="fal fa-copyright"></i> Copyright 2025
                <a href="index.html">biteexpress</a>. All Rights Reserved.
              </p>
            </div>
            <div class="footer-bottom-logo">
              <!-- <a href="index.html"
                ><img src="assets/img/logo.svg" alt="img"
              /></a> -->
              <h2 class="hero-title text-anime-style-2">BiteExpress.</h2>
            </div>
            <div class="footer-card">
              <img src="assets/img/icon/f-card.png" alt="img " />
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script src="assets/js/vendor/jquery-3.7.1.min.js"></script>
    <script src="assets/js/app.min.js"></script>
    <script src="assets/js/main.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const isAdmin = localStorage.getItem("isAdmin");

        if (parseInt(isAdmin) !== 1) {
          // Not admin, redirect to homepage
          window.location.href = "index.html";
        }
      });
      // Pagination & Filtering State
      let products = [];
      let page = 1;
      const pageSize = 4;
      let totalCount = 0;
      let selectedCategory = "All";

      document
        .getElementById("filter-category")
        .addEventListener("change", function () {
          selectedCategory = this.value;
          page = 1;
          loadProducts();
        });

      async function loadProducts() {
        let url = `http://localhost:3000/api/products?page=${page}&pageSize=${pageSize}&admin=true`;
        if (selectedCategory && selectedCategory !== "All") {
          url += `&category=${encodeURIComponent(selectedCategory)}`;
        }
        const response = await fetch(url);
        const data = await response.json();
        products = data.products || [];
        totalCount = data.totalItems || 0;
        renderProducts();
        updatePagination();
      }

      function renderProducts() {
        const tbody = document.querySelector("#products-table tbody");
        tbody.innerHTML = "";
        if (products.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7">No products found.</td></tr>';
          return;
        }
        products.forEach((product) => {
          const tr = document.createElement("tr");
          let available = product.available == 1 ? "Yes" : "No";
          tr.innerHTML = `
            <td><img src="${
              product.image_url || "assets/img/no-image.png"
            }" class="product-image" alt="${product.name}"></td>
            <td>${product.name}</td>
            <td>${product.description}</td>
            <td>${product.category || ""}</td>
            <td>${available}</td>
            <td>Rs ${Number(product.price).toFixed(2)}</td>
            <td class="action-btns">
              <button class="th-btn style2 btn-edit" data-id="${
                product.id
              }"><i class="fa fa-edit"></i> Edit</button>
              <button class="th-btn style2 btn-delete" data-id="${
                product.id
              }"><i class="fa fa-trash"></i> Delete</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      }

      function updatePagination() {
        const info = document.getElementById("pagination-info");
        const maxPage = Math.max(1, Math.ceil(totalCount / pageSize));
        info.textContent = ` Page ${page} of ${maxPage} (Total: ${totalCount}) `;
        document.getElementById("prev-page").disabled = page <= 1;
        document.getElementById("next-page").disabled = page >= maxPage;
      }

      document.getElementById("prev-page").onclick = function () {
        if (page > 1) {
          page--;
          loadProducts();
        }
      };
      document.getElementById("next-page").onclick = function () {
        const maxPage = Math.max(1, Math.ceil(totalCount / pageSize));
        if (page < maxPage) {
          page++;
          loadProducts();
        }
      };

      // Modal & Edit/Add controls
      const modalBackdrop = document.getElementById("modal-backdrop");
      const addEditModal = document.getElementById("add-edit-modal");
      const addProductBtn = document.getElementById("add-product-btn");
      const closeModalBtn = document.getElementById("close-modal");
      const addEditForm = document.getElementById("add-edit-form");
      let editingId = null;

      addProductBtn.onclick = function () {
        openModal("Add Product");
        addEditForm.reset();
        addEditForm.id.value = "";
        editingId = null;
      };

      document.body.addEventListener("click", function (e) {
        if (e.target.classList.contains("btn-edit")) {
          const id = e.target.dataset.id;
          const product = products.find((p) => p.id == id);
          if (product) {
            openModal("Edit Product");
            addEditForm.name.value = product.name;
            addEditForm.description.value = product.description;
            addEditForm.category.value = product.category;
            addEditForm.available.value = product.available;
            addEditForm.price.value = product.price;
            addEditForm.image_url.value = product.image_url;
            addEditForm.id.value = product.id;
            editingId = id;
          }
        }
        if (e.target.classList.contains("btn-delete")) {
          const id = e.target.dataset.id;
          if (confirm("Are you sure you want to delete this product?")) {
            fetch(`http://localhost:3000/api/products/${id}`, {
              method: "DELETE",
            }).then(loadProducts);
          }
        }
      });

      closeModalBtn.onclick = closeModal;
      modalBackdrop.onclick = closeModal;

      function openModal(title) {
        document.getElementById("modal-title").textContent = title;
        addEditModal.classList.add("show");
        modalBackdrop.classList.add("show");
        document.body.classList.add("modal-open");
      }
      function closeModal() {
        addEditModal.classList.remove("show");
        modalBackdrop.classList.remove("show");
        document.body.classList.remove("modal-open");
      }

      addEditForm.onsubmit = function (e) {
        e.preventDefault();
        const productData = {
          name: addEditForm.name.value,
          description: addEditForm.description.value,
          category: addEditForm.category.value,
          available: addEditForm.available.value,
          price: addEditForm.price.value,
          image_url: addEditForm.image_url.value,
        };
        let method = "POST";
        let url = "http://localhost:3000/api/products";
        if (editingId) {
          method = "PATCH";
          url = `http://localhost:3000/api/products/${editingId}`;
          productData.id = editingId;
        }
        fetch(url, {
          method: method,
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(productData),
        }).then(() => {
          closeModal();
          loadProducts();
        });
      };

      document.addEventListener("DOMContentLoaded", loadProducts);
      document
        .getElementById("adminLogoutBtn")
        .addEventListener("click", (e) => {
          // Clear all localStorage items (or only specific keys if you want)
          localStorage.clear();

          // Optionally, you can redirect after logout
          window.location.href = "admin-login.html";
        });
    </script>
  </body>
</html>
